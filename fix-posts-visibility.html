<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Posts Visibility - Kawaii Blog</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background-color: #fce4ec;
            color: #333;
        }
        h1 {
            color: #e91e63;
            text-align: center;
        }
        .urgent-box {
            background: #ffebee;
            border: 2px solid #f44336;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .instruction-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            border-radius: 4px;
        }
        .code-block {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .debug-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        button {
            background: #e91e63;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        button:hover {
            background: #d81b60;
        }
    </style>
</head>
<body>
    <h1>üå∏ Fix Posts Not Showing üå∏</h1>
    
    <div class="urgent-box">
        <h2>‚ö†Ô∏è Posts Not Visible Issue</h2>
        <p>Your posts aren't showing because of Row Level Security (RLS) policies. Let's fix this!</p>
    </div>

    <div class="debug-box">
        <h3>üîç Debug Steps</h3>
        <p>First, open your browser's Developer Console (F12) and check for these messages:</p>
        <ul>
            <li>"Database connection test:" - Shows if we can connect</li>
            <li>"Query response:" - Shows the actual data or error</li>
            <li>Any error messages about permissions</li>
        </ul>
    </div>
    
    <div class="instruction-box">
        <h2>Fix Steps</h2>
        
        <div class="step">
            <strong>Step 1:</strong> Go to your Supabase SQL Editor:
            <div class="code-block">https://supabase.com/dashboard/project/wxvcmvacajexdtcbgdva/sql/new</div>
        </div>
        
        <div class="step">
            <strong>Step 2:</strong> First, check if you have any posts:
            <div class="code-block">-- Check how many posts exist
SELECT 
  COUNT(*) as total_posts,
  COUNT(CASE WHEN is_draft = false THEN 1 END) as published_posts,
  COUNT(CASE WHEN is_draft = true THEN 1 END) as draft_posts
FROM posts;</div>
        </div>

        <div class="step">
            <strong>Step 3:</strong> If you have posts but they're not showing, run this to fix RLS:
            <div class="code-block">-- Enable RLS on posts table
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;

-- Drop existing policies
DROP POLICY IF EXISTS "Public can view published posts" ON posts;
DROP POLICY IF EXISTS "Blog owner can do everything" ON posts;

-- Allow anyone to read published posts
CREATE POLICY "Public can view published posts" ON posts
  FOR SELECT 
  USING (is_draft = false);

-- Allow blog owner to do everything
CREATE POLICY "Blog owner can do everything" ON posts
  FOR ALL 
  USING (
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE profiles.id = auth.uid() 
      AND profiles.is_blog_owner = true
    )
  );</div>
        </div>

        <div class="step">
            <strong>Step 4:</strong> If you don't have any posts yet, create one:
            <div class="code-block">-- Create a test post (replace the user_id with your actual user ID)
INSERT INTO posts (user_id, category, title, content, is_draft)
VALUES (
  (SELECT id FROM auth.users LIMIT 1),  -- Gets your user ID
  'life',
  'Welcome to my blog!',
  'This is my first post on my kawaii blog. Excited to share my daily activities!',
  false
);</div>
        </div>

        <div class="step">
            <strong>Step 5:</strong> Test if posts are now visible:
            <div class="code-block">-- This query should return your posts
SELECT id, title, content, category, created_at
FROM posts
WHERE is_draft = false
ORDER BY created_at DESC
LIMIT 5;</div>
        </div>
    </div>

    <div class="instruction-box">
        <h2>Alternative: Disable RLS Temporarily</h2>
        <p>If you're still having issues, you can temporarily disable RLS to test:</p>
        <div class="code-block">-- Disable RLS temporarily for testing
ALTER TABLE posts DISABLE ROW LEVEL SECURITY;

-- Remember to re-enable it later with proper policies!</div>
    </div>
    
    <div class="debug-box">
        <h3>‚ú® After Running These Commands</h3>
        <p>1. Go back to your blog and click the Refresh button</p>
        <p>2. Check the browser console for any errors</p>
        <p>3. Your posts should now appear in Recent Activity!</p>
    </div>
    
    <button onclick="window.location.href='http://localhost:3000'">
        Back to Kawaii Blog ‚Üí
    </button>
</body>
</html>