(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6368:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var a=s(5155),r=s(2115);let l=(0,s(4982).UU)("https://wxvcmvacajexdtcbgdva.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind4dmNtdmFjYWpleGR0Y2JnZHZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyMjMzMzYsImV4cCI6MjA2NDc5OTMzNn0.rKIixUac8fxLrHGzlXDEMz2xGcfgpX_QY6ZjhlVpWmQ");function i(e){let{user:t,onClose:s,onUpdate:i}=e,[o,n]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[x,m]=(0,r.useState)(null),[h,u]=(0,r.useState)(""),[p,g]=(0,r.useState)("");async function f(){try{n(!0);let{data:e,error:s}=await l.from("profiles").select("*").eq("id",t.id).single();if(s)throw s;e&&(m(e),u(e.username||""),g(e.avatar_url||""))}catch(e){console.error("Error loading user data:",e)}finally{n(!1)}}async function b(e){try{if(d(!0),!e.target.files||0===e.target.files.length)throw Error("You must select an image to upload.");let s=e.target.files[0],a=s.name.split(".").pop(),r="".concat(Math.random(),".").concat(a),i="".concat(t.id,"/").concat(r);console.log("Uploading to path:",i),console.log("File details:",{name:s.name,size:s.size,type:s.type});let{error:o}=await l.storage.from("avatars").upload(i,s);if(o)throw console.error("Upload error details:",o),o;let{data:n}=l.storage.from("avatars").getPublicUrl(i);g(n.publicUrl)}catch(e){console.error("Avatar upload error:",e),alert("Error uploading avatar: ".concat(e.message||e.toString()))}finally{d(!1)}}async function y(){try{n(!0);let e={id:t.id,username:h,avatar_url:p,created_at:new Date().toISOString()},{data:a,error:r}=await l.from("profiles").upsert(e).select().single();if(r)throw console.error("Profile update error:",r),r;a&&i&&i(a),alert("Profile updated successfully!"),s()}catch(e){console.error("Error updating profile:",e),alert("Error updating profile: ".concat(e.message||"Unknown error"))}finally{n(!1)}}return(0,r.useEffect)(()=>{f()},[t]),(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full shadow-xl",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Edit Profile"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"relative",children:[p?(0,a.jsx)("img",{src:p,alt:"Avatar",className:"w-24 h-24 rounded-full object-cover border-4 border-pink-200"}):(0,a.jsx)("div",{className:"w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-400",children:"No image"})}),(0,a.jsx)("label",{htmlFor:"avatar",className:"absolute bottom-0 right-0 bg-pink-400 rounded-full p-2 cursor-pointer hover:bg-pink-500 transition-colors",children:(0,a.jsxs)("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,a.jsx)("input",{type:"file",id:"avatar",accept:"image/*",onChange:b,disabled:c,className:"hidden"})]}),c&&(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Uploading..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,a.jsx)("input",{id:"username",type:"text",value:h,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300",placeholder:"Enter your username"})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:o,children:"Cancel"}),(0,a.jsx)("button",{onClick:y,className:"flex-1 px-4 py-2 bg-pink-400 text-white rounded-lg hover:bg-pink-500 transition-colors disabled:opacity-50",disabled:o||c,children:o?"Saving...":"Save"})]})]})]})})}function o(){let[e,t]=(0,r.useState)(null),[s,o]=(0,r.useState)(""),[n,c]=(0,r.useState)(""),[d,x]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{l.auth.getSession().then(e=>{var s;let{data:{session:a}}=e;t(null!=(s=null==a?void 0:a.user)?s:null)});let{data:{subscription:e}}=l.auth.onAuthStateChange((e,s)=>{var a;t(null!=(a=null==s?void 0:s.user)?a:null)});return()=>e.unsubscribe()},[]);let u=async()=>{x(!0);let{error:e}=await l.auth.signUp({email:s,password:n});e?alert(e.message):alert("Check your email for confirmation!"),x(!1)},p=async()=>{x(!0);let{error:e}=await l.auth.signInWithPassword({email:s,password:n});e&&alert(e.message),x(!1)},g=async()=>{await l.auth.signOut()},[f,b]=(0,r.useState)(!1);return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute top-2 right-2 sm:top-4 sm:right-4 z-50",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-end sm:items-center gap-2 sm:gap-3 bg-white/95 backdrop-blur p-2 sm:px-4 sm:py-2 rounded-2xl sm:rounded-full border border-gray-200 shadow-sm",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm text-gray-700 px-2 sm:px-0 truncate max-w-[150px] sm:max-w-none",children:e.email}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>h(!0),className:"px-3 py-1 sm:px-4 sm:py-1.5 bg-pink-400 text-white rounded-full text-xs sm:text-sm hover:bg-pink-500 transition-colors",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Edit Profile"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Edit"})]}),(0,a.jsxs)("button",{onClick:g,className:"px-3 py-1 sm:px-4 sm:py-1.5 bg-gray-900 text-white rounded-full text-xs sm:text-sm hover:bg-gray-800 transition-colors",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Sign Out"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Out"})]})]})]})}),m&&(0,a.jsx)(i,{user:e,onClose:()=>h(!1),onUpdate:()=>{}})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute top-2 right-2 sm:top-4 sm:right-4 z-50",children:(0,a.jsxs)("button",{onClick:()=>b(!f),className:"px-4 py-1.5 sm:px-5 sm:py-2 bg-gray-900 text-white rounded-full text-xs sm:text-sm hover:bg-gray-800 transition-colors flex items-center gap-1 sm:gap-2 shadow-sm",children:[(0,a.jsx)("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),"Login"]})}),f&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>b(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-8 max-w-sm w-full mx-4 shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 tracking-tight",children:"Sign in to your account"}),(0,a.jsx)("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"email",placeholder:"Email address",value:s,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"}),(0,a.jsx)("input",{type:"password",placeholder:"Password",value:n,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent transition-all"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:p,disabled:d,className:"flex-1 px-4 py-3 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 disabled:opacity-50 transition-colors",children:d?"Loading...":"Sign In"}),(0,a.jsx)("button",{onClick:u,disabled:d,className:"flex-1 px-4 py-3 bg-white text-gray-900 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 disabled:opacity-50 transition-colors",children:d?"Loading...":"Sign Up"})]})]})]})})]})}var n=s(1934),c=s(2177),d=s(9509);let x={clear:"☀️",clouds:"☁️",rain:"\uD83C\uDF27️",drizzle:"\uD83C\uDF26️",thunderstorm:"⛈️",snow:"❄️",mist:"\uD83C\uDF2B️",fog:"\uD83C\uDF2B️",haze:"\uD83C\uDF2B️"};function m(e){let{onWeatherUpdate:t}=e,[s,l]=(0,r.useState)(null),[i,o]=(0,r.useState)(!1),[n,c]=(0,r.useState)(!1),m=async()=>{o(!0);try{let{latitude:e,longitude:s}=(await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)})).coords,a=d.env.NEXT_PUBLIC_OPENWEATHER_API_KEY||"demo",r=await fetch("https://api.openweathermap.org/data/2.5/weather?lat=".concat(e,"&lon=").concat(s,"&appid=").concat(a,"&units=metric"));if(!r.ok){let e={temp:18,condition:"clear",icon:"☀️",location:"Toronto"};l(e),t(e);return}let i=await r.json(),o={temp:Math.round(i.main.temp),condition:i.weather[0].main.toLowerCase(),icon:x[i.weather[0].main.toLowerCase()]||"\uD83C\uDF24️",location:i.name};l(o),t(o)}catch(s){console.error("Weather fetch error:",s);let e={temp:18,condition:"clear",icon:"☀️",location:"Toronto"};l(e),t(e)}finally{o(!1)}};return(0,r.useEffect)(()=>{n?m():(l(null),t(null))},[n]),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"font-pixel text-pixel-sm text-kawaii-text font-bold",children:"\uD83C\uDF24️ Current Weather"}),(0,a.jsx)("button",{type:"button",onClick:()=>c(!n),className:"px-3 py-1 border-2 border-kawaii-border rounded font-pixel text-pixel-xs transition-colors pixel-ui ".concat(n?"bg-kawaii-accent":"bg-kawaii-surface"),style:{borderStyle:"outset"},children:n?"Disable":"Enable"})]}),n&&(0,a.jsx)("div",{className:"bg-kawaii-surface border-2 border-kawaii-border rounded-lg p-3 pixel-ui",style:{borderStyle:"inset"},children:i?(0,a.jsx)("p",{className:"font-pixel text-pixel-xs text-kawaii-text",children:"Getting weather..."}):s?(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:s.icon}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-pixel text-pixel-sm text-kawaii-text",children:[s.temp,"\xb0C - ",s.condition]}),(0,a.jsxs)("p",{className:"font-pixel text-pixel-xs text-kawaii-text/60",children:["\uD83D\uDCCD ",s.location]})]})]}),(0,a.jsx)("button",{type:"button",onClick:m,className:"px-2 py-1 bg-kawaii-background border border-kawaii-border rounded font-pixel text-pixel-xs hover:bg-kawaii-accent transition-colors pixel-ui",style:{borderStyle:"outset"},children:"Refresh"})]}):(0,a.jsx)("p",{className:"font-pixel text-pixel-xs text-kawaii-text/60",children:"Weather disabled"})})]})}function h(e){var t;let{onClose:s,editPost:i,isBlogOwner:o=!1}=e;if(!o)return(0,a.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",onClick:s,children:(0,a.jsxs)(n.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 pointer-events-auto text-center",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Only the blog owner can create or edit posts."}),(0,a.jsx)("button",{onClick:s,className:"bg-gray-900 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors",children:"Close"})]})});let[d,x]=(0,r.useState)(!1),[h,u]=(0,r.useState)({images:(null==i?void 0:i.image_urls)||[],videos:(null==i?void 0:i.video_urls)||[]}),[p,g]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!i),[y,j]=(0,r.useState)(null),{register:v,handleSubmit:w,reset:N,setValue:k,watch:_}=(0,c.mN)({defaultValues:i?{content:i.content,hashtags:(null==(t=i.hashtags)?void 0:t.join(" "))||""}:{content:"",hashtags:""}}),C=async(e,t)=>{if(!e||0===e.length)return[];g(!0);let s=[];try{for(let a=0;a<e.length;a++){let r=e[a],i=r.name.split(".").pop(),o="".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2),".").concat(i),n="".concat(t,"/").concat(o),{error:c}=await l.storage.from("posts").upload(n,r);if(c)throw c;let{data:{publicUrl:d}}=l.storage.from("posts").getPublicUrl(n);s.push(d)}return u(e=>({...e,[t]:[...e[t],...s]})),s}catch(e){return console.error("Error uploading files:",e),alert("Failed to upload ".concat(t,": ").concat(e)),[]}finally{g(!1)}},S=(e,t)=>{let s=e.target.files;s&&C(s,t)},P=(e,t)=>{u(s=>({...s,[t]:s[t].filter(t=>t!==e)}))},E=async e=>{x(!0);try{let{data:{user:t}}=await l.auth.getUser();if(!t)return void alert("You must be logged in to create posts");let a=e.hashtags?e.hashtags.split(" ").filter(e=>e.trim().length>0):[],r={category:(null==i?void 0:i.category)||"life",title:"Untitled",content:e.content,hashtags:a,image_urls:h.images,video_urls:h.videos,is_draft:!1,updated_at:new Date().toISOString(),weather:y,user_id:t.id};if(i){let{error:e}=await l.from("posts").update(r).eq("id",i.id);if(e)throw e;alert("Post updated successfully! ✨")}else{let{error:e}=await l.from("posts").insert(r);if(e)throw e;alert("Post created successfully! \uD83C\uDF89")}window.dispatchEvent(new Event("user-interaction")),N(),u({images:[],videos:[]}),s()}catch(e){console.error("Error ".concat(i?"updating":"creating"," post:"),e),alert("Failed to ".concat(i?"update":"create"," post: ").concat(e.message||"Unknown error"))}finally{x(!1)}};return(0,a.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-1 sm:p-4 pointer-events-none",onClick:s,children:(0,a.jsxs)(n.P.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"bg-white bg-opacity-90 backdrop-blur-sm rounded-2xl shadow-2xl max-w-2xl w-full max-h-[95vh] overflow-y-auto pointer-events-auto mx-1 sm:mx-4",onClick:e=>e.stopPropagation(),transition:{duration:.3,ease:"easeOut"},children:[(0,a.jsxs)("div",{className:"sticky top-0 z-10 bg-white bg-opacity-90 backdrop-blur-sm flex items-center justify-between p-3 sm:p-6 border-b border-gray-200 rounded-t-2xl",children:[(0,a.jsxs)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCDD"}),i?"Edit":"Create"," Post"]}),(0,a.jsx)("button",{onClick:s,className:"w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-gray-500 hover:text-gray-700 transition-colors",children:"\xd7"})]}),(0,a.jsx)("div",{className:"p-4 sm:p-6",children:(0,a.jsxs)("form",{onSubmit:w(E),className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2 font-medium text-sm",children:"What's on your mind?"}),(0,a.jsx)("textarea",{...v("content",{required:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none h-24",placeholder:"Share your thoughts..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2 font-medium text-sm",children:"Hashtags:"}),(0,a.jsx)("input",{...v("hashtags"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"#life #thoughts #daily"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2 font-medium text-sm",children:"Photos:"}),(0,a.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>S(e,"images"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p}),h.images.length>0&&(0,a.jsx)("div",{className:"mt-2 grid grid-cols-2 sm:grid-cols-3 gap-2",children:h.images.map((e,t)=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:e,alt:"Upload ".concat(t+1),className:"w-full h-20 object-cover rounded border border-gray-300"}),(0,a.jsx)("button",{type:"button",onClick:()=>P(e,"images"),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hover:bg-red-600",children:"\xd7"})]},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-700 mb-2 font-medium text-sm",children:"Videos:"}),(0,a.jsx)("input",{type:"file",multiple:!0,accept:"video/*",onChange:e=>S(e,"videos"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p}),h.videos.length>0&&(0,a.jsx)("div",{className:"mt-2 space-y-2",children:h.videos.map((e,t)=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("video",{src:e,className:"w-full h-32 object-cover rounded border border-gray-300",controls:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>P(e,"videos"),className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hover:bg-red-600",children:"\xd7"})]},t))})]}),p&&(0,a.jsx)("div",{className:"text-center text-gray-600 text-sm",children:"Uploading files... \uD83D\uDCE4"}),(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200",children:(0,a.jsx)(m,{onWeatherUpdate:j})}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:d,className:"flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"Posting...":"Post"}),(0,a.jsx)("button",{type:"button",onClick:s,className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})})]})})}function u(){let e=localStorage.getItem("kawaii_blog_session");return e||(e="anon_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("kawaii_blog_session",e)),e}function p(e){let{onPostClick:t,onEditPost:s,onDeletePost:i,isBlogOwner:o}=e,[c,d]=(0,r.useState)([]),[x,m]=(0,r.useState)(!0),[h,p]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!0),[b,y]=(0,r.useState)({}),[j,v]=(0,r.useState)({}),[w,N]=(0,r.useState)(null);(0,r.useEffect)(()=>{k(),_();let e=P();return()=>{e()}},[]);let k=async()=>{let{data:{user:e}}=await l.auth.getUser();N(e)},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{t?p(!0):m(!0);let{data:s,error:a}=await l.from("posts").select("id, title, content, category, created_at, hashtags, image_urls, video_urls, music, weather, user_id").order("created_at",{ascending:!1}).range(e,e+10-1);if(a)throw console.error("Supabase error:",a.message||a),a;let r=s||[],{data:{user:i}}=await l.auth.getUser(),o=[...new Set(r.map(e=>e.user_id).filter(Boolean))],n={};for(let e of o)try{let{data:t,error:s}=await l.from("profiles").select("username, avatar_url").eq("id",e).single();t&&!s?n[e]={username:t.username||"User",avatar_url:t.avatar_url}:n[e]={username:"User",avatar_url:void 0}}catch(t){console.error("Error fetching user profile:",t),n[e]={username:"User",avatar_url:void 0}}let c=r.map(e=>{let t={username:"Anonymous User",avatar_url:void 0};return e.user_id&&n[e.user_id]&&(t=n[e.user_id],i&&i.id===e.user_id&&(t={...t,username:"You"})),{...e,profiles:t}});t?d(e=>[...e,...c]):d(c),c.length>0&&await C(c.map(e=>e.id)),f(10===r.length)}catch(e){console.error("Error fetching posts:",e.message||e),t||d([])}finally{m(!1),p(!1)}},C=async e=>{try{let{data:t}=await l.from("likes").select("post_id").in("post_id",e),s={};if(e.forEach(e=>s[e]=0),null==t||t.forEach(e=>{s[e.post_id]=(s[e.post_id]||0)+1}),y(e=>({...e,...s})),w){let{data:t}=await l.from("likes").select("post_id").in("post_id",e).eq("user_id",w.id),s={};null==t||t.forEach(e=>{s[e.post_id]=!0}),v(e=>({...e,...s}))}else{let t=u(),{data:s}=await l.from("likes").select("post_id").in("post_id",e).eq("session_id",t),a={};null==s||s.forEach(e=>{a[e.post_id]=!0}),v(e=>({...e,...a}))}}catch(e){console.error("Error fetching likes:",e)}},S=async(e,t)=>{e.stopPropagation();try{if(j[t]){if(w)await l.from("likes").delete().eq("post_id",t).eq("user_id",w.id);else{let e=u();await l.from("likes").delete().eq("post_id",t).eq("session_id",e)}y(e=>({...e,[t]:Math.max(0,(e[t]||0)-1)})),v(e=>({...e,[t]:!1}))}else{let e=w?{post_id:t,user_id:w.id}:{post_id:t,session_id:u()};await l.from("likes").insert(e),y(e=>({...e,[t]:(e[t]||0)+1})),v(e=>({...e,[t]:!0}))}}catch(e){console.error("Error toggling like:",e)}},P=()=>{let e=l.channel("all_posts_updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"posts"},()=>{_()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"posts"},()=>{_()}).on("postgres_changes",{event:"DELETE",schema:"public",table:"posts"},()=>{_()}).subscribe();return()=>{l.removeChannel(e)}},E=e=>{let t=new Date(e),s=new Date().getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(s/36e5),l=Math.floor(s/864e5);return a<1?"just now":a<60?"".concat(a,"m"):r<24?"".concat(r,"h"):"".concat(l,"d")},M=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:280;return e.length<=t?e:e.substring(0,t)+"..."},D=e=>0===e?"":1===e?"1 like":e>=1e3?"".concat((e/1e3).toFixed(1),"k likes"):"".concat(e," likes");return x?(0,a.jsx)("div",{className:"space-y-4 p-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"h-24 bg-gray-100 rounded-xl animate-pulse"},t))}):(0,a.jsx)("div",{className:"flex flex-col h-full",children:(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[c.length>0?(0,a.jsx)(n.P.div,{className:"space-y-0 divide-y divide-gray-200",children:c.map(e=>{var r,l,c,d;return(0,a.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"bg-white hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>null==t?void 0:t(e.id),children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden flex items-center justify-center bg-gradient-to-br from-blue-400 to-purple-500",children:(null==(r=e.profiles)?void 0:r.avatar_url)?(0,a.jsx)("img",{src:e.profiles.avatar_url,alt:e.profiles.username||"User",className:"w-full h-full object-cover"}):(0,a.jsx)("span",{className:"text-white font-semibold text-sm",children:(null==(c=e.profiles)||null==(l=c.username)?void 0:l.charAt(0).toUpperCase())||"B"})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:(null==(d=e.profiles)?void 0:d.username)||"Blog Owner"}),(0,a.jsx)("span",{className:"text-gray-500",children:"\xb7"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:E(e.created_at)})]})})]}),e.weather&&(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsxs)("div",{className:"bg-gray-50 px-3 py-2 rounded-xl inline-flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:e.weather.icon}),(0,a.jsxs)("span",{className:"text-xs text-gray-600 font-medium",children:[e.weather.temp,"\xb0C in ",e.weather.location]})]})}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("p",{className:"text-gray-900 leading-relaxed whitespace-pre-wrap",children:M(e.content)})}),e.image_urls&&e.image_urls.length>0&&(0,a.jsx)("div",{className:"mb-3 -mx-4",children:(0,a.jsx)("img",{src:e.image_urls[0],alt:"Post",className:"w-full h-64 object-cover"})}),e.hashtags&&e.hashtags.length>0&&(0,a.jsx)("div",{className:"mb-3",children:e.hashtags.map((e,t)=>(0,a.jsxs)("span",{className:"text-sm text-blue-500 mr-2 hover:text-blue-600 cursor-pointer transition-colors font-medium",children:["#",e]},t))}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)(n.P.button,{onClick:t=>S(t,e.id),className:"flex items-center gap-2 transition-all",whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:j[e.id]?"#ef4444":"none",stroke:j[e.id]?"#ef4444":"#6b7280",strokeWidth:"2",className:"cursor-pointer transition-colors hover:stroke-red-500",children:(0,a.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:D(b[e.id]||0)})]}),(0,a.jsxs)("button",{className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors",children:[(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),(0,a.jsx)("span",{className:"text-sm",children:"Comment"})]}),o&&(0,a.jsxs)("div",{className:"ml-auto flex gap-2",children:[(0,a.jsx)(n.P.button,{onClick:t=>{t.stopPropagation(),null==s||s(e)},className:"transition-colors",title:"Edit post",whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,a.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"cursor-pointer text-gray-500 hover:text-gray-700",children:[(0,a.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,a.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,a.jsx)(n.P.button,{onClick:t=>{t.stopPropagation(),null==i||i(e)},className:"transition-colors",title:"Delete post",whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,a.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"cursor-pointer text-red-500 hover:text-red-700",children:[(0,a.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,a.jsx)("path",{d:"M19,6V20a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6M8,6V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2V6"}),(0,a.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,a.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]})]})},e.id)})}):(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"No posts yet."}),o&&(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Create your first post to get started!"})]}),g&&c.length>0&&(0,a.jsx)("div",{className:"p-4 text-center",children:(0,a.jsx)("button",{onClick:()=>{_(c.length,!0)},disabled:h,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:h?"Loading...":"Load More"})})]})})}function g(e){let{postId:t,isExpanded:s}=e,[i,o]=(0,r.useState)([]),[n,c]=(0,r.useState)(""),[d,x]=(0,r.useState)(""),[m,h]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(s){g();let e=f();return()=>null==e?void 0:e()}},[t,s]);let g=async()=>{h(!0);try{let{data:e,error:s}=await l.from("comments").select("*").eq("post_id",t).order("created_at",{ascending:!0});if(s)throw s;o(e||[])}catch(e){console.error("Error fetching comments:",e)}finally{h(!1)}},f=()=>{let e=l.channel("comments:".concat(t)).on("postgres_changes",{event:"INSERT",schema:"public",table:"comments",filter:"post_id=eq.".concat(t)},e=>{o(t=>[...t,e.new])}).subscribe();return()=>{l.removeChannel(e)}},b=async e=>{if(e.preventDefault(),n.trim()){p(!0);try{let{data:{user:e}}=await l.auth.getUser(),s={post_id:t,content:n.trim(),author_name:e?"kawaii_blogger":d.trim()||"Anonymous",user_id:(null==e?void 0:e.id)||null};console.log("Submitting comment:",s);let{data:a,error:r}=await l.from("comments").insert(s).select();if(r)throw console.error("Supabase error:",r),r;console.log("Comment created:",a),c(""),x(""),g()}catch(e){console.error("Error posting comment:",e),alert("Failed to post comment: ".concat(e.message||"Unknown error"))}finally{p(!1)}}},y=e=>{let t=new Date(e),s=new Date().getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(s/36e5),l=Math.floor(s/864e5);return a<1?"just now":a<60?"".concat(a,"m ago"):r<24?"".concat(r,"h ago"):"".concat(l,"d ago")};return s?(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t-2 border-green-200",children:[m?(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Loading comments..."}):(0,a.jsxs)("div",{className:"space-y-3 mb-4 max-h-48 overflow-y-auto",children:[i.map(e=>(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-bold",children:e.author_name||"kawaii_blogger"})," ",e.content]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:y(e.created_at)})]})},e.id)),0===i.length&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"No comments yet. Be the first!"})]}),(0,a.jsx)("form",{onSubmit:b,className:"space-y-2",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"Add a comment...",value:n,onChange:e=>c(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:u}),(0,a.jsx)("button",{type:"submit",disabled:u||!n.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Post"})]})})]}):null}function f(e){let{spotifyId:t,type:s="track"}=e;if(!t)return null;let r="https://open.spotify.com/embed/".concat(s,"/").concat(t,"?utm_source=generator&theme=0");return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)("iframe",{src:r,width:"100%",height:"track"===s?80:200,frameBorder:"0",allowFullScreen:!0,allow:"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture",loading:"lazy",className:"rounded-lg"})})}let b={eat:(0,a.jsx)("svg",{className:"w-5 h-5 text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),sleep:(0,a.jsx)("svg",{className:"w-5 h-5 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),study:(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),play:(0,a.jsx)("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m-4-6h4a2 2 0 012 2v4a2 2 0 01-2 2H9a2 2 0 01-2-2v-4a2 2 0 012-2z"})}),life:(0,a.jsx)("svg",{className:"w-5 h-5 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})};function y(){let e=localStorage.getItem("kawaii_blog_session");return e||(e="anon_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("kawaii_blog_session",e)),e}function j(e){var t,s,i;let{postId:o,onClose:c,onEditPost:d,onDeletePost:x,isBlogOwner:m=!1}=e,[h,u]=(0,r.useState)(null),[p,j]=(0,r.useState)(!0),[v,w]=(0,r.useState)(0),[N,k]=(0,r.useState)(!1),[_,C]=(0,r.useState)(null);(0,r.useEffect)(()=>{P(),S()},[o]);let S=async()=>{let{data:{user:e}}=await l.auth.getUser();C(e)},P=async()=>{try{console.log("Fetching post with ID:",o);let{data:e,error:t}=await l.from("posts").select("*").eq("id",o).single();if(console.log("Post query result:",{data:e,error:t}),t)throw t;let s={...e,profiles:{username:"Blog Owner",avatar_url:null}};u(s),await E(e.id)}catch(e){console.error("Error fetching post:",e)}finally{j(!1)}},E=async e=>{try{let{count:t}=await l.from("likes").select("*",{count:"exact"}).eq("post_id",e);if(w(t||0),_){let{data:t,error:s}=await l.from("likes").select("id").eq("post_id",e).eq("user_id",_.id).maybeSingle();s?console.error("Error checking user like:",s):k(!!t)}else{let t=y(),{data:s,error:a}=await l.from("likes").select("id").eq("post_id",e).eq("session_id",t).maybeSingle();a?console.error("Error checking session like:",a):k(!!s)}}catch(e){console.error("Error fetching likes:",e)}},M=async()=>{if(h)try{if(N){if(_)await l.from("likes").delete().eq("post_id",h.id).eq("user_id",_.id);else{let e=y();await l.from("likes").delete().eq("post_id",h.id).eq("session_id",e)}w(e=>Math.max(0,e-1)),k(!1)}else{let e=_?{post_id:h.id,user_id:_.id}:{post_id:h.id,session_id:y()};await l.from("likes").insert(e),w(e=>e+1),k(!0)}}catch(e){console.error("Error toggling like:",e)}};return p?(0,a.jsx)(n.P.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)("div",{className:"bg-white rounded-2xl p-8",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto"})})}):h?(0,a.jsx)(n.P.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,children:(0,a.jsxs)(n.P.div,{className:"bg-white border border-gray-200 rounded-2xl overflow-hidden shadow-sm max-w-lg w-full max-h-[90vh] overflow-y-auto",style:{maxWidth:"468px",width:"100%"},initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 p-3 sm:p-4",children:[(0,a.jsx)("div",{className:"w-8 sm:w-10 h-8 sm:h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-semibold text-xs sm:text-sm",children:(null==(s=h.profiles)||null==(t=s.username)?void 0:t.charAt(0).toUpperCase())||"B"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:(null==(i=h.profiles)?void 0:i.username)||"Blog Owner"}),(!h.image_urls||0===h.image_urls.length)&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["\xb7 ",new Date(h.created_at).toLocaleDateString()]})]}),"sleep"!==h.category&&h.image_urls&&h.image_urls.length>0&&(0,a.jsx)("div",{className:"flex items-center gap-1 mt-0.5",children:(0,a.jsx)("span",{className:"text-xs text-gray-500",children:h.title})})]}),(0,a.jsx)("button",{onClick:c,className:"p-1 text-gray-600 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h.weather&&(0,a.jsx)("div",{className:"px-3 sm:px-4 mb-3",children:(0,a.jsxs)("div",{className:"bg-gray-50 px-3 py-2 rounded-xl inline-flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:h.weather.icon}),(0,a.jsxs)("span",{className:"text-xs text-gray-600 font-medium",children:[h.weather.temp,"\xb0C in ",h.weather.location]})]})}),"sleep"!==h.category&&h.image_urls&&h.image_urls.length>0&&(0,a.jsx)("div",{className:"relative bg-gray-50 flex items-center justify-center",style:{height:"300px"},children:(0,a.jsx)("img",{src:h.image_urls[0],alt:"Post",className:"w-full h-full object-cover"})}),"sleep"===h.category&&(0,a.jsxs)("div",{className:"mb-3 mx-3 sm:mx-4 flex items-center gap-3 bg-gray-50 px-3 sm:px-4 py-2 sm:py-3 rounded-xl",children:[(0,a.jsx)(n.P.div,{className:"flex items-center justify-center",animate:{rotate:[-10,10,-10]},transition:{duration:4,repeat:1/0,ease:"easeInOut"},children:(0,a.jsx)("div",{className:"w-8 h-8 flex items-center justify-center",children:b[h.category]&&r.cloneElement(b[h.category],{className:"w-6 h-6"})})}),(0,a.jsx)("div",{className:"text-gray-500 text-xs",children:new Date(h.created_at).toLocaleDateString()})]}),h.image_urls&&h.image_urls.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4 px-3 sm:px-4 py-2 sm:py-3",children:[(0,a.jsx)(n.P.button,{onClick:M,className:"transition-transform",whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,a.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:N?"#ef4444":"none",stroke:N?"#ef4444":"#374151",strokeWidth:"2",className:"cursor-pointer transition-colors hover:stroke-red-500",children:(0,a.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),m&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.P.button,{onClick:()=>null==d?void 0:d(h),className:"transition-colors",title:"Edit post",whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"cursor-pointer text-gray-500 hover:text-gray-700",children:[(0,a.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,a.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,a.jsx)(n.P.button,{onClick:()=>null==x?void 0:x(h),className:"transition-colors",title:"Delete post",whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,a.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"cursor-pointer text-red-500 hover:text-red-700",children:[(0,a.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,a.jsx)("path",{d:"M19,6V20a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6M8,6V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2V6"}),(0,a.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,a.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]}),h.image_urls&&h.image_urls.length>0&&(0,a.jsx)("p",{className:"font-semibold text-gray-900 text-sm px-3 sm:px-4 mb-2",children:0===v?"Be the first to like this!":1===v?"1 like":v>=1e3?"".concat((v/1e3).toFixed(1),"k likes"):"".concat(v," likes")}),(0,a.jsx)("div",{className:"mb-3 px-3 sm:px-4",children:(0,a.jsx)("p",{className:"text-gray-900 leading-relaxed whitespace-pre-wrap",children:h.content})}),(!h.image_urls||0===h.image_urls.length)&&(0,a.jsx)("div",{className:"px-3 sm:px-4 mb-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(n.P.button,{onClick:M,className:"flex items-center gap-1 transition-all",whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:N?"#ef4444":"none",stroke:N?"#ef4444":"#6b7280",strokeWidth:"2",className:"cursor-pointer transition-colors hover:stroke-red-500",children:(0,a.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:v})]}),m&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.P.button,{onClick:()=>null==d?void 0:d(h),className:"transition-colors",title:"Edit post",whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,a.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"cursor-pointer text-gray-500 hover:text-gray-700",children:[(0,a.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,a.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,a.jsx)(n.P.button,{onClick:()=>null==x?void 0:x(h),className:"transition-colors",title:"Delete post",whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,a.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"cursor-pointer text-red-500 hover:text-red-700",children:[(0,a.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,a.jsx)("path",{d:"M19,6V20a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6M8,6V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2V6"}),(0,a.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,a.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]})}),h.hashtags&&h.hashtags.length>0&&(0,a.jsx)("div",{className:"mb-3 px-3 sm:px-4",children:h.hashtags.map((e,t)=>(0,a.jsxs)("span",{className:"text-xs text-blue-500 mr-2 hover:text-blue-600 cursor-pointer transition-colors font-medium",children:["#",e]},t))}),h.spotify_urls&&h.spotify_urls.length>0&&(0,a.jsx)("div",{className:"mb-3 px-3 sm:px-4 space-y-3",children:h.spotify_urls.map((e,t)=>{var s;let r=null==(s=e.split("/").pop())?void 0:s.split("?")[0],l=e.includes("/track/")?"track":e.includes("/playlist/")?"playlist":"album";return(0,a.jsx)(f,{spotifyId:r,type:l},t)})}),(0,a.jsx)("div",{className:"px-3 sm:px-4 pb-3",children:(0,a.jsx)(g,{postId:h.id,isExpanded:!0})})]})}):(0,a.jsx)(n.P.div,{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-8",children:[(0,a.jsx)("p",{className:"text-red-500",children:"Post not found"}),(0,a.jsx)("button",{onClick:c,className:"mt-4 px-4 py-2 bg-gray-200 rounded-lg",children:"Close"})]})})}function v(e){let{isOpen:t,post:s,onConfirm:r,onCancel:l}=e;return t?(0,a.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:l,children:(0,a.jsxs)(n.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl p-0 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:"\uD83D\uDDD1️ Delete Post"}),(0,a.jsx)("button",{onClick:l,className:"w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-gray-500 hover:text-gray-700 transition-colors",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-900 mb-3",children:"Are you sure you want to delete this post?"}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm font-bold text-gray-900",children:(null==s?void 0:s.title)||"Sleep Log"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:[null==s?void 0:s.content.substring(0,100),"..."]})]})]}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 p-3 rounded-lg mb-4",children:(0,a.jsx)("p",{className:"text-xs text-red-700",children:"⚠️ This action cannot be undone. All comments and likes will also be deleted."})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:l,className:"flex-1 px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{onClick:r,className:"flex-1 px-4 py-2 bg-red-600 rounded-lg text-sm font-medium text-white hover:bg-red-700 transition-colors",children:"Delete"})]})]})]})}):null}function w(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)(""),[o,n]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[x,m]=(0,r.useState)(""),[h,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{p(),g(),b()},[]);let p=async()=>{let{data:{user:e}}=await l.auth.getUser();if(e){let{data:t}=await l.from("profiles").select("is_blog_owner").eq("id",e.id).single();u((null==t?void 0:t.is_blog_owner)||!1)}},g=async()=>{let{data:e,error:s}=await l.from("now_playing").select("*").single();e&&!s&&t(e)},b=()=>{let e=l.channel("now_playing_updates").on("postgres_changes",{event:"*",schema:"public",table:"now_playing"},()=>{g()}).subscribe();return()=>{l.removeChannel(e)}},y=async()=>{if(m(""),!s)return void m("Please enter a Spotify URL");let e=function(e){try{let t=new URL(e),s=t.pathname.split("/").filter(e=>e.length>0);if("open.spotify.com"===t.hostname){let e=-1,t=null;for(let a=0;a<s.length;a++)if(["track","playlist","album"].includes(s[a])){t=s[a],e=a;break}if(t&&e>=0&&s[e+1]){let a=s[e+1].split("?")[0];if(a)return{id:a,type:t}}}}catch(e){}return null}(s);if(!e)return void m("Please enter a valid Spotify link");d(!0);try{let t,{data:{user:a}}=await l.auth.getUser();if(!a)return void m("You must be logged in to update");let r={user_id:a.id,spotify_id:e.id,spotify_type:e.type,title:"Spotify ".concat(e.type),embed_url:"https://open.spotify.com/embed/".concat(e.type,"/").concat(e.id),updated_at:new Date().toISOString()};try{let e=await fetch("https://open.spotify.com/oembed?url=".concat(encodeURIComponent(s)));if(e.ok){let t=await e.json();if(t.title){let e=t.title.split(" \xb7 ");e.length>=2?Object.assign(r,{title:e[0],artist:e.slice(1).join(" \xb7 ")}):Object.assign(r,{title:t.title})}}}catch(e){}let{data:o}=await l.from("now_playing").select("id").eq("user_id",a.id).single();if(o){let{error:e}=await l.from("now_playing").update(r).eq("user_id",a.id);t=e}else{let{error:e}=await l.from("now_playing").insert(r);t=e}if(t)throw console.error("Supabase error:",t),t;i(""),n(!1),g()}catch(e){console.error("Error updating now playing:",e),m("Failed to update: ".concat(e.message||e))}finally{d(!1)}};return(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"",children:!e||o?(0,a.jsx)("div",{children:h?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-xs font-bold",children:"S"})}),(0,a.jsx)("span",{className:"text-xs text-gray-700",children:"Share from Spotify"})]}),(0,a.jsx)("input",{type:"text",placeholder:"Paste Spotify link (song, playlist, or album)...",value:s,onChange:e=>{i(e.target.value),m("")},className:"w-full px-2 py-2 border border-gray-300 rounded text-xs bg-white focus:outline-none focus:ring-1 focus:ring-green-500 transition-all"}),x&&(0,a.jsx)("p",{className:"text-xs text-red-600",children:x}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:y,disabled:c,className:"px-3 py-1 bg-green-500 text-white rounded text-xs font-medium hover:bg-green-600 transition-colors disabled:opacity-50",children:c?"Updating...":"Update"}),e&&(0,a.jsx)("button",{onClick:()=>n(!1),className:"px-3 py-1 bg-white text-gray-700 border border-gray-300 rounded text-xs font-medium hover:bg-gray-50 transition-colors",children:"Cancel"})]})]}):(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Nothing playing right now"})}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center animate-pulse",children:(0,a.jsx)("span",{className:"text-white text-xs font-bold",children:"S"})}),(0,a.jsxs)("div",{children:[e.title&&e.artist?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:e.artist})]}):(0,a.jsxs)("p",{className:"text-xs font-medium text-gray-900",children:["Spotify ",e.spotify_type]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(e=>{let t=new Date(e),s=new Date().getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(s/36e5),l=Math.floor(s/864e5);return a<1?"just now":a<60?"".concat(a,"m ago"):r<24?"".concat(r,"h ago"):"".concat(l,"d ago")})(e.updated_at)})]})]}),h&&(0,a.jsx)("button",{onClick:()=>n(!0),className:"px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs font-medium hover:bg-gray-200 transition-colors",children:"Change"})]}),(0,a.jsx)(f,{spotifyId:e.spotify_id,type:e.spotify_type}),(0,a.jsxs)("a",{href:"https://open.spotify.com/".concat(e.spotify_type,"/").concat(e.spotify_id),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 transition-colors",children:["Open in Spotify",(0,a.jsxs)("svg",{width:"8",height:"8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),(0,a.jsx)("polyline",{points:"15 3 21 3 21 9"}),(0,a.jsx)("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]})]})})})}function N(){let[e,t]=(0,r.useState)(!1),[s,i]=(0,r.useState)(!1),[n,c]=(0,r.useState)(null),[d,x]=(0,r.useState)(null),[m,u]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(!1),[N,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{console.log("\uD83D\uDE80 React component mounted! Page.tsx is running"),k(!0)},[]);let _=e=>{x(e),t(!0),i(!1)},C=e=>{f(e),u(!0)},S=async()=>{if(g)try{let{error:e}=await l.from("posts").delete().eq("id",g.id);if(e)throw e;alert("Post deleted successfully! \uD83D\uDDD1️"),u(!1),f(null),window.location.reload()}catch(e){console.error("Error deleting post:",e),alert("Failed to delete post: ".concat(e.message||"Unknown error"))}};return(0,r.useEffect)(()=>{let e=async()=>{try{let{data:{user:e}}=await l.auth.getUser();if(e){let{data:t}=await l.from("profiles").select("is_blog_owner").eq("id",e.id).single();y((null==t?void 0:t.is_blog_owner)||!1)}else y(!1)}catch(e){console.error("Error checking blog owner status:",e),y(!1)}};e();let{data:{subscription:t}}=l.auth.onAuthStateChange(()=>{e()});return()=>t.unsubscribe()},[]),(0,a.jsx)("main",{className:"min-h-screen bg-gray-50 p-0",children:(0,a.jsxs)("div",{className:"min-h-screen flex flex-col relative",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-white",children:[(0,a.jsx)(o,{}),(0,a.jsx)("header",{className:"bg-gradient-to-r from-blue-50 to-purple-50 px-4 sm:px-6 py-5 sm:py-6 border-b border-gray-200 shadow-sm",children:(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 text-center font-[var(--font-poppins)] tracking-tight",children:"Daily Check-In"})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col lg:grid lg:grid-cols-4 min-h-0",children:[(0,a.jsx)("div",{className:"hidden lg:block lg:col-span-1 lg:border-r border-gray-200 bg-white",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-gray-900 mb-2 tracking-tight",children:"About"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 leading-relaxed",children:"Hi! Stop checking on me directly, just look at this. How easy right?"})]})}),(0,a.jsxs)("div",{className:"flex-1 lg:flex-initial lg:col-span-2 lg:border-r border-b lg:border-b-0 border-gray-200 bg-white order-2 lg:order-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"border-b border-gray-200 bg-gray-50 px-4 py-2 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-gray-900 tracking-tight",children:"All Posts"}),b&&(0,a.jsx)("button",{onClick:()=>{console.log("Create post clicked"),x(null),t(!0)},className:"bg-blue-500 text-white px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-blue-600 transition-colors",children:"Create Post"})]}),(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)(p,{onPostClick:e=>{console.log("\uD83D\uDCDD Post clicked:",e),c(e),i(!0)},onEditPost:_,onDeletePost:C,isBlogOwner:b})})]}),(0,a.jsxs)("div",{className:"lg:col-span-1 bg-white flex flex-col h-auto lg:h-full order-1 lg:order-2",children:[(0,a.jsx)("div",{className:"lg:hidden border-b border-gray-200",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-gray-900 mb-2 tracking-tight",children:"About"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 leading-relaxed",children:"Hi! Stop checking on me directly, just look at this. How easy right?"})]})}),(0,a.jsxs)("div",{className:"border-b border-gray-200",children:[(0,a.jsx)("div",{className:"border-b border-gray-200 bg-gray-50 px-4 py-2",children:(0,a.jsx)("h2",{className:"text-sm font-medium text-gray-900 tracking-tight",children:"Now Playing"})}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(w,{})})]})]})]})]}),e&&(0,a.jsx)(h,{editPost:d,isBlogOwner:b,onClose:()=>{t(!1),x(null)}}),N&&s&&n&&(0,a.jsx)(j,{postId:n,onEditPost:_,onDeletePost:C,isBlogOwner:b,onClose:()=>{i(!1),c(null)}}),(0,a.jsx)(v,{isOpen:m,post:g,onConfirm:S,onCancel:()=>{u(!1),f(null)}})]})})}},9129:(e,t,s)=>{Promise.resolve().then(s.bind(s,6368))}},e=>{var t=t=>e(e.s=t);e.O(0,[871,441,684,358],()=>t(9129)),_N_E=e.O()}]);